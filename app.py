import streamlit as st

# ---------------------------------------------------------
# 1. データベース（テキストに基づく12色の定義）
# ---------------------------------------------------------
# 引用元: テキスト P.71~82, P.120-121
COLOR_DB = {
    "Red": {
        "name": "レッド (R)",
        "meaning": "行動力・情熱・経営感覚",
        "positive": "エネルギーに満ち溢れ、現実を動かす力があります。フットワークが軽く、義理堅いリーダータイプです。",
        "low_msg": "【課題】無気力・現実逃避\n経済的な不安や、地に足がついていない感覚がありませんか？\n身体を動かすエネルギーが不足しているかもしれません。",
        "prescription": "運動、散歩、トイレ掃除、雑巾がけ"
    },
    "Coral": {
        "name": "コーラルレッド (C)",
        "meaning": "本能・母性・繊細さ",
        "positive": "直感や身体感覚が鋭く、場の空気を肌で感じる力があります。人を育てる母性や優しさを持っています。",
        "low_msg": "【課題】神経過敏・依存\n相手に尽くしすぎて、自分をすり減らしていませんか？\n「愛されたい」という思いから依存的になっているかもしれません。",
        "prescription": "岩盤浴、ヨガ、気功、身体を温める"
    },
    "Orange": {
        "name": "オレンジ (O)",
        "meaning": "感情・美意識・食",
        "positive": "五感が鋭く、人生を楽しむ達人です。美味しいものや美しいものに感動する心を持っています。",
        "low_msg": "【課題】感情の抑圧・不感症\nワクワクする気持ちを忘れていませんか？\nショックなことがあり、感情に蓋をしている可能性があります。",
        "prescription": "ダンス、マッサージ、温泉、美味しいものを味わう"
    },
    "Gold": {
        "name": "ゴールド (G)",
        "meaning": "信念・カリスマ・中心",
        "positive": "揺るぎない信念と自分軸を持っています。組織の中心人物として、存在感だけで人を惹きつけます。",
        "low_msg": "【課題】不安・自信喪失\n「自分には価値がない」と感じていませんか？\n根拠のない不安や恐れに襲われているかもしれません。",
        "prescription": "アファメーション（自分への宣言）、チャレンジする"
    },
    "Yellow": {
        "name": "イエロー (Y)",
        "meaning": "論理・ユーモア・知識",
        "positive": "頭の回転が速く、知識豊富で教えるのが得意です。独自のユーモアで周囲を明るくします。",
        "low_msg": "【課題】胃痛・思考停止\n考えすぎて胃が痛くなったり、どうしていいか分からず混乱していませんか？\n「正解」を探しすぎているかもしれません。",
        "prescription": "お笑いを見る、趣味に没頭する、笑うこと"
    },
    "Lime": {
        "name": "ライムグリーン (L)",
        "meaning": "女性性リーダー・気配り",
        "positive": "柔らかい物腰で周囲を巻き込む力があります。真の優しさと強さを兼ね備えたリーダーです。",
        "low_msg": "【課題】過小評価・卑下\n過去の傷ついた経験から、自分を小さく見積もっていませんか？\nハートに恐れがあるかもしれません。",
        "prescription": "モーツァルトを聴く、緑の中に行く"
    },
    "Green": {
        "name": "グリーン (E)",
        "meaning": "協調・平和・傾聴",
        "positive": "聞き上手で、一緒にいるだけで相手を癒やす力があります。調和を大切にするサポーターです。",
        "low_msg": "【課題】拒絶・心の壁\n言いたいことが言えず、心に壁を作っていませんか？\n変化を恐れて、自分の殻に閉じこもっているかもしれません。",
        "prescription": "呼吸法、森林浴、リラックスする音楽"
    },
    "Aqua": {
        "name": "アクアブルー (A)",
        "meaning": "創造・同調・表現",
        "positive": "芸術的な感性を持ち、言葉にしなくても相手の気持ちを察する共感力があります。",
        "low_msg": "【課題】空気が読めない・同化\n周りの目が気になりすぎて、自分らしさを出せていないのではありませんか？\n相手の感情をもらいすぎているかもしれません。",
        "prescription": "歌う、絵を描く、塗り絵など「表現」すること"
    },
    "Blue": {
        "name": "ブルー (B)",
        "meaning": "伝達・責任・冷静",
        "positive": "冷静沈着で、物事を完璧にこなす実務能力があります。言葉で伝える力に優れています。",
        "low_msg": "【課題】完璧主義・閉鎖\n「〜せねばならない」という思い込みで、自分を縛り付けていませんか？\n言いたいことを飲み込んでしまっています。",
        "prescription": "写経、座禅、文章を書く、頭を空っぽにする"
    },
    "Navy": {
        "name": "ネイビーブルー (N)",
        "meaning": "直感・分析・本質",
        "positive": "物事の本質を見抜く洞察力があります。宇宙意識と繋がり、直感的に答えを導き出します。",
        "low_msg": "【課題】批判・孤独\n将来のビジョンが見えず、閉塞感を感じていませんか？\n直感が鈍り、理屈でジャッジしやすくなっています。",
        "prescription": "瞑想、何かに没頭・集中すること"
    },
    "Violet": {
        "name": "ヴァイオレット (V)",
        "meaning": "変容・統合・慈悲",
        "positive": "対立するものを統合し、癒やす力があります。スピリチュアルな感性が高く、奉仕の精神を持ちます。",
        "low_msg": "【課題】優柔不断・逃避\n現状から逃げ出したいと思っていませんか？\n自分に厳しくしすぎて、バランスを崩しているかもしれません。",
        "prescription": "神社仏閣への参拝、奉仕活動、瞑想"
    },
    "Magenta": {
        "name": "マゼンタピンク (M)",
        "meaning": "無償の愛・博愛",
        "positive": "見返りを求めない大きな愛で、すべてを包み込む力があります。地球規模の視点を持っています。",
        "low_msg": "【課題】愛の枯渇・孤独\n「誰にも愛されていない」「認められていない」という孤独感を感じていませんか？\n自己否定の気持ちが強くなっています。",
        "prescription": "募金、ボランティア、感謝を伝える"
    }
}

# 選択肢用のリスト
COLOR_OPTIONS = list(COLOR_DB.keys())
COLOR_NAMES = [COLOR_DB[k]["name"] for k in COLOR_OPTIONS]

# ---------------------------------------------------------
# 2. アプリ画面構成
# ---------------------------------------------------------
st.title("🎤 QTV 声解析・診断アプリ")
st.caption("グラフを見て、「強く出ている色」と「出ていない色」を選んでください。")

# 波形選択
analysis_mode = st.radio(
    "どの波形を診断しますか？",
    ("V1 (顕在意識・外向きの自分)", "V2 (下意識・思考の癖)", "V3 (潜在意識・本質)"),
    horizontal=True
)
[span_0](start_span)[span_1](start_span)st.info("※V1は社会的な振る舞い、V2は習慣や癖、V3は本来の自分を表します。[span_0](end_span)[span_1](end_span)")

st.markdown("---")

# ---------------------------------------------------------
# 入力エリア (上位2つ、下位1つ)
# ---------------------------------------------------------
col1, col2 = st.columns(2)

with col1:
    st.subheader("🟥 上位（強み）")
    st.caption("グラフで一番高い色、二番目に高い色を選んでください")
    
    top1_key = st.selectbox(
        "1位の色", 
        COLOR_OPTIONS, 
        format_func=lambda x: COLOR_DB[x]["name"],
        key="top1"
    )
    
    top2_key = st.selectbox(
        "2位の色", 
        COLOR_OPTIONS, 
        format_func=lambda x: COLOR_DB[x]["name"],
        index=3, # 初期値を適当にずらす
        key="top2"
    )

with col2:
    st.subheader("🟦 下位（課題）")
    st.caption("グラフで一番低い（凹んでいる、無い）色を選んでください")
    
    bottom_key = st.selectbox(
        "ワースト（不足）の色", 
        COLOR_OPTIONS, 
        format_func=lambda x: COLOR_DB[x]["name"],
        index=8,
        key="bottom"
    )

# ---------------------------------------------------------
# 診断実行
# ---------------------------------------------------------
st.markdown("---")

if st.button("診断する", type="primary"):
    st.header("📊 診断結果")

    # --- 上位（強み）の診断 ---
    st.subheader("✨ あなたの強み・才能")
    
    # 1位
    d1 = COLOR_DB[top1_key]
    st.markdown(f"### 👑 1位：{d1['name']}")
    st.success(f"**キーワード: {d1['meaning']}**")
    st.write(d1['positive'])
    [span_2](start_span)[span_3](start_span)st.caption(f"波形が高い部分は、あなたの才能や個性が発揮されている部分です。[span_2](end_span)[span_3](end_span)")
    
    # 2位
    d2 = COLOR_DB[top2_key]
    with st.expander(f"🥈 2位：{d2['name']} の詳細を見る", expanded=True):
        st.markdown(f"**キーワード: {d2['meaning']}**")
        st.write(d2['positive'])

    # --- 下位（課題）の診断 ---
    st.markdown("---")
    st.subheader("💊 今の課題と処方箋")
    
    d_low = COLOR_DB[bottom_key]
    st.markdown(f"### ⚠️ 不足している色：{d_low['name']}")
    
    st.warning(f"**心当たりのある状態:**\n\n{d_low['low_msg']}")
    [span_4](start_span)[span_5](start_span)st.write("波形の低い部分（凹の部分）に、人生の課題やヒントが隠されています。[span_4](end_span)[span_5](end_span)")
    
    st.markdown("### ✨ おすすめのアクション（処方箋）")
    st.info(f"**{d_low['prescription']}**")
    [span_6](start_span)[span_7](start_span)st.caption("不足している色の要素を補うことで、バランスを整えましょう。まずは21日間チャレンジ！[span_6](end_span)[span_7](end_span)")

st.markdown("---")
st.caption("監修: クォンタムヴォイスアカデミー 認定インストラクター")
